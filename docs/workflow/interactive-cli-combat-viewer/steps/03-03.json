{
  "task_id": "03-03",
  "project_id": "interactive-cli-combat-viewer",
  "execution_agent": "software-crafter",
  "self_contained_context": {
    "background": "Part of Phase 3: Visual Enhancement (Emoji, Colors, Pacing). Visual enhancements transform plain text into engaging combat narrative. HP color gradient\nprovides intuitive health status. Emoji add visual interest and cross-cultural clarity.\n",
    "prerequisites_completed": [
      "03-02"
    ],
    "relevant_files": [
      "modules/infrastructure/cli/combat_renderer.py (modify)"
    ],
    "technical_context": "Update CombatRenderer to use emoji and Rich color styling.\n\nFile: modules/infrastructure/cli/combat_renderer.py (update)\n\nMajor changes:\n\n1. Use config.get_symbol() for all emoji:\n```python\ndef _render_initiative(self, init_result) -> None:\n    dice_emoji = self._config.get_symbol('dice')\n    init_emoji = self._config.get_symbol('initiative')\n\n    self._console.print(f\"{dice_emoji} Rolling Initiative...\", style=\"bold cyan\")\n    # ...\n    self._console.print(f\"{init_emoji} {init_result.attacker.name} wins initiative and attacks first!\", style=\"bold yellow\")\n```\n\n2. Add color styling to HP display:\n```python\ndef _hp_color(self, current_hp: int, max_hp: int) -> str:\n    \"\"\"Return color based on HP percentage.\"\"\"\n    pct = current_hp / max_hp\n    if pct >= 0.7:\n        return \"green\"\n    elif pct >= 0.4:\n        return \"yellow\"\n    elif pct >= 0.2:\n        return \"orange\"\n    else:\n        return \"red\"\n```\n\n3. Update round rendering with full emoji and colors:\n```python\ndef _render_round(self, round_result) -> None:\n    # Header\n    attack_emoji = self._config.get_symbol('attack')\n    self._console.print(f\"\\n{'='*35}\", style=\"dim\")\n    self._console.print(f\"{attack_emoji}  ROUND {round_result.round_number}\", style=\"bold magenta\")\n    self._console.print(f\"{'='*35}\", style=\"dim\")\n    self._console.display_with_delay(\"\", self._config.round_header_delay)\n\n    # Attacker action\n    action = round_result.attacker_action\n    dice_emoji = self._config.get_symbol('dice')\n    damage_emoji = self._config.get_symbol('damage')\n    hp_emoji = self._config.get_symbol('hp')\n\n    self._console.print(f\"\\n{attack_emoji}  {action.attacker_name} attacks!\", style=\"bold cyan\")\n    self._console.print(f\"   {dice_emoji} Roll: {action.dice_roll} + ⚔️  Power: {action.attack_power} = {damage_emoji} {action.total_damage} damage\", style=\"yellow\")\n\n    hp_color = self._hp_color(action.defender_new_hp, action.defender_old_hp)\n    self._console.print(f\"   {action.defender_name}: {action.defender_old_hp} HP → {action.defender_new_hp} HP\", style=hp_color)\n    self._console.display_with_delay(\"\", self._config.attack_delay)\n\n    # Defender counter-attack (if alive)\n    if round_result.defender_action:\n        defend_emoji = self._config.get_symbol('defend')\n        action = round_result.defender_action\n\n        self._console.print(f\"\\n{defend_emoji}  {action.attacker_name} counter-attacks!\", style=\"bold blue\")\n        self._console.print(f\"   {dice_emoji} Roll: {action.dice_roll} + ⚔️  Power: {action.attack_power} = {damage_emoji} {action.total_damage} damage\", style=\"yellow\")\n\n        hp_color = self._hp_color(action.defender_new_hp, action.defender_old_hp)\n        self._console.print(f\"   {action.defender_name}: {action.defender_old_hp} HP → {action.defender_new_hp} HP\", style=hp_color)\n        self._console.display_with_delay(\"\", self._config.attack_delay)\n    else:\n        death_emoji = self._config.get_symbol('death')\n        self._console.print(f\"\\n{death_emoji}  {round_result.attacker_action.defender_name} has been defeated!\", style=\"bold red dim\")\n        self._console.display_with_delay(\"\", self._config.death_delay)\n```\n\n4. Update victory rendering:\n```python\ndef _render_victory(self, result: CombatResult) -> None:\n    victory_emoji = self._config.get_symbol('victory')\n    death_emoji = self._config.get_symbol('death')\n\n    self._console.print(f\"\\n{'╔' + '═'*35 + '╗'}\", style=\"bold yellow\")\n    self._console.print(f\"║  {victory_emoji}  {result.winner.name.upper()} WINS!  {victory_emoji}  ║\", style=\"bold yellow\")\n    self._console.print(f\"{'╚' + '═'*35 + '╝'}\", style=\"bold yellow\")\n\n    self._console.print(f\"\\nCombat lasted {result.total_rounds} rounds\", style=\"dim\")\n    self._console.print(f\"{result.winner.name}: {result.winner.hp} HP remaining\", style=\"green\")\n    self._console.print(f\"{result.loser.name}: 0 HP {death_emoji} (defeated)\", style=\"red dim\")\n\n    self._console.prompt_continue(\"\\nPremi INVIO per uscire (o CTRL-C per terminare)\")\n```\n\nUnit tests updates:\n- Update existing tests to verify emoji in output\n- Add test: test_hp_color_gradient()\n- Add test: test_emoji_used_in_all_messages()\n\nValidation:\n- pytest tests/unit/infrastructure/cli/test_combat_renderer.py -v\n",
    "tdd_phase": "GREEN",
    "active_e2e_test": "E2E Test 3.1 (Combat Visualization) - should PASS when complete",
    "inactive_e2e_tests": "All E2E tests except the active one should remain disabled with @pytest.mark.skip or similar"
  },
  "task_specification": {
    "name": "Enhance CombatRenderer with Emoji and Colors",
    "description": "Update CombatRenderer to use emoji and Rich color styling.\n\nFile: modules/infrastructure/cli/combat_renderer.py (update)\n\nMajor changes:\n\n1. Use config.get_symbol() for all emoji:\n```python\ndef _render_initiative(self, init_result) -> None:\n    dice_emoji = self._config.get_symbol('dice')\n    init_emoji = self._config.get_symbol('initiative')\n\n    self._console.print(f\"{dice_emoji} Rolling Initiative...\", style=\"bold cyan\")\n    # ...\n    self._console.print(f\"{init_emoji} {init_result.attacker.name} wins initiative and attacks first!\", style=\"bold yellow\")\n```\n\n2. Add color styling to HP display:\n```python\ndef _hp_color(self, current_hp: int, max_hp: int) -> str:\n    \"\"\"Return color based on HP percentage.\"\"\"\n    pct = current_hp / max_hp\n    if pct >= 0.7:\n        return \"green\"\n    elif pct >= 0.4:\n        return \"yellow\"\n    elif pct >= 0.2:\n        return \"orange\"\n    else:\n        return \"red\"\n```\n\n3. Update round rendering with full emoji and colors:\n```python\ndef _render_round(self, round_result) -> None:\n    # Header\n    attack_emoji = self._config.get_symbol('attack')\n    self._console.print(f\"\\n{'='*35}\", style=\"dim\")\n    self._console.print(f\"{attack_emoji}  ROUND {round_result.round_number}\", style=\"bold magenta\")\n    self._console.print(f\"{'='*35}\", style=\"dim\")\n    self._console.display_with_delay(\"\", self._config.round_header_delay)\n\n    # Attacker action\n    action = round_result.attacker_action\n    dice_emoji = self._config.get_symbol('dice')\n    damage_emoji = self._config.get_symbol('damage')\n    hp_emoji = self._config.get_symbol('hp')\n\n    self._console.print(f\"\\n{attack_emoji}  {action.attacker_name} attacks!\", style=\"bold cyan\")\n    self._console.print(f\"   {dice_emoji} Roll: {action.dice_roll} + ⚔️  Power: {action.attack_power} = {damage_emoji} {action.total_damage} damage\", style=\"yellow\")\n\n    hp_color = self._hp_color(action.defender_new_hp, action.defender_old_hp)\n    self._console.print(f\"   {action.defender_name}: {action.defender_old_hp} HP → {action.defender_new_hp} HP\", style=hp_color)\n    self._console.display_with_delay(\"\", self._config.attack_delay)\n\n    # Defender counter-attack (if alive)\n    if round_result.defender_action:\n        defend_emoji = self._config.get_symbol('defend')\n        action = round_result.defender_action\n\n        self._console.print(f\"\\n{defend_emoji}  {action.attacker_name} counter-attacks!\", style=\"bold blue\")\n        self._console.print(f\"   {dice_emoji} Roll: {action.dice_roll} + ⚔️  Power: {action.attack_power} = {damage_emoji} {action.total_damage} damage\", style=\"yellow\")\n\n        hp_color = self._hp_color(action.defender_new_hp, action.defender_old_hp)\n        self._console.print(f\"   {action.defender_name}: {action.defender_old_hp} HP → {action.defender_new_hp} HP\", style=hp_color)\n        self._console.display_with_delay(\"\", self._config.attack_delay)\n    else:\n        death_emoji = self._config.get_symbol('death')\n        self._console.print(f\"\\n{death_emoji}  {round_result.attacker_action.defender_name} has been defeated!\", style=\"bold red dim\")\n        self._console.display_with_delay(\"\", self._config.death_delay)\n```\n\n4. Update victory rendering:\n```python\ndef _render_victory(self, result: CombatResult) -> None:\n    victory_emoji = self._config.get_symbol('victory')\n    death_emoji = self._config.get_symbol('death')\n\n    self._console.print(f\"\\n{'╔' + '═'*35 + '╗'}\", style=\"bold yellow\")\n    self._console.print(f\"║  {victory_emoji}  {result.winner.name.upper()} WINS!  {victory_emoji}  ║\", style=\"bold yellow\")\n    self._console.print(f\"{'╚' + '═'*35 + '╝'}\", style=\"bold yellow\")\n\n    self._console.print(f\"\\nCombat lasted {result.total_rounds} rounds\", style=\"dim\")\n    self._console.print(f\"{result.winner.name}: {result.winner.hp} HP remaining\", style=\"green\")\n    self._console.print(f\"{result.loser.name}: 0 HP {death_emoji} (defeated)\", style=\"red dim\")\n\n    self._console.prompt_continue(\"\\nPremi INVIO per uscire (o CTRL-C per terminare)\")\n```\n\nUnit tests updates:\n- Update existing tests to verify emoji in output\n- Add test: test_hp_color_gradient()\n- Add test: test_emoji_used_in_all_messages()\n\nValidation:\n- pytest tests/unit/infrastructure/cli/test_combat_renderer.py -v\n",
    "motivation": "Visual enhancements transform plain text into engaging combat narrative. HP color gradient\nprovides intuitive health status. Emoji add visual interest and cross-cultural clarity.\n",
    "detailed_instructions": "Update CombatRenderer to use emoji and Rich color styling.\n\nFile: modules/infrastructure/cli/combat_renderer.py (update)\n\nMajor changes:\n\n1. Use config.get_symbol() for all emoji:\n```python\ndef _render_initiative(self, init_result) -> None:\n    dice_emoji = self._config.get_symbol('dice')\n    init_emoji = self._config.get_symbol('initiative')\n\n    self._console.print(f\"{dice_emoji} Rolling Initiative...\", style=\"bold cyan\")\n    # ...\n    self._console.print(f\"{init_emoji} {init_result.attacker.name} wins initiative and attacks first!\", style=\"bold yellow\")\n```\n\n2. Add color styling to HP display:\n```python\ndef _hp_color(self, current_hp: int, max_hp: int) -> str:\n    \"\"\"Return color based on HP percentage.\"\"\"\n    pct = current_hp / max_hp\n    if pct >= 0.7:\n        return \"green\"\n    elif pct >= 0.4:\n        return \"yellow\"\n    elif pct >= 0.2:\n        return \"orange\"\n    else:\n        return \"red\"\n```\n\n3. Update round rendering with full emoji and colors:\n```python\ndef _render_round(self, round_result) -> None:\n    # Header\n    attack_emoji = self._config.get_symbol('attack')\n    self._console.print(f\"\\n{'='*35}\", style=\"dim\")\n    self._console.print(f\"{attack_emoji}  ROUND {round_result.round_number}\", style=\"bold magenta\")\n    self._console.print(f\"{'='*35}\", style=\"dim\")\n    self._console.display_with_delay(\"\", self._config.round_header_delay)\n\n    # Attacker action\n    action = round_result.attacker_action\n    dice_emoji = self._config.get_symbol('dice')\n    damage_emoji = self._config.get_symbol('damage')\n    hp_emoji = self._config.get_symbol('hp')\n\n    self._console.print(f\"\\n{attack_emoji}  {action.attacker_name} attacks!\", style=\"bold cyan\")\n    self._console.print(f\"   {dice_emoji} Roll: {action.dice_roll} + ⚔️  Power: {action.attack_power} = {damage_emoji} {action.total_damage} damage\", style=\"yellow\")\n\n    hp_color = self._hp_color(action.defender_new_hp, action.defender_old_hp)\n    self._console.print(f\"   {action.defender_name}: {action.defender_old_hp} HP → {action.defender_new_hp} HP\", style=hp_color)\n    self._console.display_with_delay(\"\", self._config.attack_delay)\n\n    # Defender counter-attack (if alive)\n    if round_result.defender_action:\n        defend_emoji = self._config.get_symbol('defend')\n        action = round_result.defender_action\n\n        self._console.print(f\"\\n{defend_emoji}  {action.attacker_name} counter-attacks!\", style=\"bold blue\")\n        self._console.print(f\"   {dice_emoji} Roll: {action.dice_roll} + ⚔️  Power: {action.attack_power} = {damage_emoji} {action.total_damage} damage\", style=\"yellow\")\n\n        hp_color = self._hp_color(action.defender_new_hp, action.defender_old_hp)\n        self._console.print(f\"   {action.defender_name}: {action.defender_old_hp} HP → {action.defender_new_hp} HP\", style=hp_color)\n        self._console.display_with_delay(\"\", self._config.attack_delay)\n    else:\n        death_emoji = self._config.get_symbol('death')\n        self._console.print(f\"\\n{death_emoji}  {round_result.attacker_action.defender_name} has been defeated!\", style=\"bold red dim\")\n        self._console.display_with_delay(\"\", self._config.death_delay)\n```\n\n4. Update victory rendering:\n```python\ndef _render_victory(self, result: CombatResult) -> None:\n    victory_emoji = self._config.get_symbol('victory')\n    death_emoji = self._config.get_symbol('death')\n\n    self._console.print(f\"\\n{'╔' + '═'*35 + '╗'}\", style=\"bold yellow\")\n    self._console.print(f\"║  {victory_emoji}  {result.winner.name.upper()} WINS!  {victory_emoji}  ║\", style=\"bold yellow\")\n    self._console.print(f\"{'╚' + '═'*35 + '╝'}\", style=\"bold yellow\")\n\n    self._console.print(f\"\\nCombat lasted {result.total_rounds} rounds\", style=\"dim\")\n    self._console.print(f\"{result.winner.name}: {result.winner.hp} HP remaining\", style=\"green\")\n    self._console.print(f\"{result.loser.name}: 0 HP {death_emoji} (defeated)\", style=\"red dim\")\n\n    self._console.prompt_continue(\"\\nPremi INVIO per uscire (o CTRL-C per terminare)\")\n```\n\nUnit tests updates:\n- Update existing tests to verify emoji in output\n- Add test: test_hp_color_gradient()\n- Add test: test_emoji_used_in_all_messages()\n\nValidation:\n- pytest tests/unit/infrastructure/cli/test_combat_renderer.py -v\n",
    "acceptance_criteria": [
      "All combat messages use config.get_symbol()",
      "_hp_color() method calculates gradient",
      "HP display uses color based on percentage",
      "Round headers use bold styling",
      "Victory banner uses decorative borders",
      "Unit tests verify emoji presence",
      "Manual test: Emoji display correctly"
    ],
    "estimated_hours": 3.0
  },
  "dependencies": {
    "requires": [
      "03-02"
    ],
    "blocking": [
      "03-04"
    ]
  },
  "state": {
    "status": "TODO",
    "assigned_to": null,
    "started_at": null,
    "completed_at": null,
    "updated": "2026-01-10T12:41:07.248054+00:00"
  }
}
